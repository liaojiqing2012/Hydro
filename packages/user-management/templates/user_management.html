{% extends "manage_base.html" %}
{% block manage_content %}
<div class="section">
  <div class="section__header">
    <h1 class="section__title">{{ _('user_management') }}</h1>
    <p class="section__desc">{{ _('user_management_description') }}</p>
    <div class="section__tools">
      <form class="inline" method="get" action="">
        <label class="input-group">
          <span class="input-addon">{{ _('user_management_keyword') }}</span>
          <input type="text" name="q" value="{{ keyword }}" placeholder="{{ _('user_management_keyword') }}">
        </label>
        <label class="input-group">
          <span class="input-addon">{{ _('user_management_sort_by') }}</span>
          <select name="sort">
              <option value="uid"{% if sort == 'uid' %} selected{% endif %}>{{ _('user_management_uid') }}</option>
              <option value="uname"{% if sort == 'uname' %} selected{% endif %}>{{ _('user_management_uname') }}</option>
              <option value="displayName"{% if sort == 'displayName' %} selected{% endif %}>{{ _('user_management_display_name') }}</option>
              <option value="studentId"{% if sort == 'studentId' %} selected{% endif %}>{{ _('user_management_student_id') }}</option>
              <option value="school"{% if sort == 'school' %} selected{% endif %}>{{ _('user_management_school') }}</option>
              <option value="email"{% if sort == 'email' %} selected{% endif %}>{{ _('user_management_email') }}</option>
              <option value="regat"{% if sort == 'regat' %} selected{% endif %}>{{ _('user_management_registered') }}</option>
              <option value="loginat"{% if sort == 'loginat' %} selected{% endif %}>{{ _('user_management_last_login') }}</option>
              <option value="role"{% if sort == 'role' %} selected{% endif %}>{{ _('user_management_role') }}</option>
              <option value="priv"{% if sort == 'priv' %} selected{% endif %}>{{ _('user_management_privilege') }}</option>
              <option value="loginip"{% if sort == 'loginip' %} selected{% endif %}>{{ _('user_management_last_login_ip') }}</option>
          </select>
        </label>
        <label class="input-group">
          <span class="input-addon">{{ _('user_management_sort_order') }}</span>
          <select name="order">
              <option value="asc"{% if order == 'asc' %} selected{% endif %}>{{ _('user_management_sort_asc') }}</option>
              <option value="desc"{% if order == 'desc' %} selected{% endif %}>{{ _('user_management_sort_desc') }}</option>
          </select>
        </label>
        <button class="primary rounded button" type="submit">
          <span class="icon icon-search"></span> {{ _('user_management_search') }}
        </button>
      </form>
    </div>
  </div>
  <div class="section__body no-padding">
    <table class="data-table">
      <colgroup>
        <col class="col--uid">
        <col class="col--user">
        <col class="col--user">
        <col class="col--student">
        <col class="col--school">
        <col class="col--mail">
        <col class="col--role">
        <col class="col--priv">
        <col class="col--date">
        <col class="col--date">
        <col class="col--ip">
      </colgroup>
      <thead>
        <tr>
          <th class="col--uid">{{ _('user_management_uid') }}</th>
          <th class="col--user">{{ _('user_management_uname') }}</th>
          <th class="col--user">{{ _('user_management_display_name') }}</th>
          <th class="col--student">{{ _('user_management_student_id') }}</th>
          <th class="col--school">{{ _('user_management_school') }}</th>
          <th class="col--mail">{{ _('user_management_email') }}</th>
          <th class="col--role">{{ _('user_management_role') }}</th>
          <th class="col--priv">{{ _('user_management_privilege') }}</th>
          <th class="col--date">{{ _('user_management_registered') }}</th>
          <th class="col--date">{{ _('user_management_last_login') }}</th>
          <th class="col--ip">{{ _('user_management_last_login_ip') }}</th>
        </tr>
      </thead>
      <tbody>
        {% if users.length == 0 %}
        <tr>
          <td class="col--empty" colspan="11">{{ _('user_management_empty') }}</td>
        </tr>
        {% else %}
          {% for u in users %}
          <tr>
            <td class="col--uid">{{ u._id }}</td>
            <td class="col--user"><a href="{{ url('user_detail', { uid: u._id }) }}">{{ u.uname }}</a></td>
            <td class="col--user">{{ u.displayName or '-' }}</td>
            <td class="col--student">{{ u.studentId or '-' }}</td>
            <td class="col--school">{{ u.school or '-' }}</td>
            <td class="col--mail">{{ u.mail }}</td>
            <td class="col--role">{{ u.role }}</td>
            <td class="col--priv">{{ u.priv }}</td>
            <td class="col--date">{{ datetimeSpan(u.regat) | safe }}</td>
            <td class="col--date">{{ datetimeSpan(u.loginat) | safe }}</td>
            <td class="col--ip">{{ u.loginip or '-' }}</td>
          </tr>
          {% endfor %}
        {% endif %}
      </tbody>
      {% if totalPages > 1 %}
      <tfoot>
        <tr>
          <td colspan="11" class="pagination">
            <div class="row align-middle">
              <div class="columns small-6">{{ _('Page {0} / {1}', page, totalPages) }}</div>
              <div class="columns small-6 align-right">
                {% if page > 1 %}
                  <a class="button" href="{{ url('user_management', { page: page - 1, q: keyword, sort: sort, order: order }) }}">&laquo; {{ _('Prev') }}</a>
                {% endif %}
                {% if page < totalPages %}
                  <a class="button" href="{{ url('user_management', { page: page + 1, q: keyword, sort: sort, order: order }) }}">{{ _('Next') }} &raquo;</a>
                {% endif %}
              </div>
            </div>
          </td>
        </tr>
      </tfoot>
      {% endif %}
    </table>
  </div>
</div>
{% endblock %}
